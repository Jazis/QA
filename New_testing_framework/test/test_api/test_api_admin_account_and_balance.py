import allure
from playwright.sync_api import APIRequestContext

from data.responses_texts import AUTH_NOT_PROVIDED, PERMISSIONS


@allure.title('Admin account list')
def test_admin_account_list(auth_token, api_request_context: APIRequestContext) -> None:
    headers = {
        'Authorization': f"Token {auth_token}"
    }
    response = api_request_context.get(
        '/api/admin/account?date_start=2024-05-18&date_end=2024-05-18', headers=headers
    )

    assert response.status == 200
    assert response.text().__contains__('"next":"https://dev.api.devhost.io/api/admin/account?date_end=2024-05-18&date_start=2024-05-18&page=2","previous":null,"results":{"total_sum":{"money_in":0.0,"money_out":-0.0,"balance"')
    assert response.text().__contains__('"begin_balance"')
    assert response.text().__contains__('"settled":0.0,"refund":0.0,"pending":0.0,"reversed_amount":0.0,"fx_fee":0.0,"cross_border_fee":0.0,"decline_fee":0.0,"spend":-0.0},"data":[{"id":4,"name":"1021481","type":3,"company":{"id":1,"name":"MTS","owner_type":"client"},"provider":{"id":2,"name":"ConnexPay","stage":null},"status":"active"')
    assert response.text().__contains__('"id":9,"name":"1015104","type":3,"company":{"id":6,"name":"ConnCompany","owner_type":"client"},"provider":{"id":2,"name":"ConnexPay","stage":null},"status":"active","active_cards":20,"money_in":0.0,"money_out":-0.0,"balance":2929.3599999999715,"begin_balance":2929.3599999999715,"settled":0.0,"refund":0.0,"pending":0.0,"reversed_amount":0.0,"fx_fee":0.0,"cross_border_fee":0.0,"decline_fee":0.0,"spend":-0.0')
    assert response.text().__contains__('"id":179,"name":"1041407","type":3,"company":{"id":170,"name":"grey company","owner_type":"client"},"provider":{"id":2,"name":"ConnexPay","stage":null},"status":"active","active_cards":2,"money_in":0.0,"money_out":-0.0,"balance":2560.96,"begin_balance":2560.96,"settled":0.0,"refund":0.0,"pending":0.0,"reversed_amount":0.0,"fx_fee":0.0,"cross_border_fee":0.0,"decline_fee":0.0,"spend":-0.0')
    assert response.text().__contains__('"id":177,"name":"1026728","type":3,"company":{"id":168,"name":"red company","owner_type":"client"},"provider":{"id":2,"name":"ConnexPay","stage":null},"status":"active","active_cards":2,"money_in":0.0,"money_out":-0.0,"balance":2434.7,"begin_balance":2434.7,"settled":0.0,"refund":0.0,"pending":0.0,"reversed_amount":0.0,"fx_fee":0.0,"cross_border_fee":0.0,"decline_fee":0.0,"spend":-0.0')
    assert response.text().__contains__('"id":7,"name":"1062148","type":3,"company":{"id":4,"name":"Tesla","owner_type":"client"},"provider":{"id":2,"name":"ConnexPay","stage":null},"status":"active","active_cards":5,"money_in":0.0,"money_out":-0.0,"balance":2265.0,"begin_balance":2265.0,"settled":0.0,"refund":0.0,"pending":0.0,"reversed_amount":0.0,"fx_fee":0.0,"cross_border_fee":0.0,"decline_fee":0.0,"spend":-0.0')
    assert response.text().__contains__('"id":182,"name":"1025391","type":3,"company":{"id":173,"name":"black company","owner_type":"client"},"provider":{"id":2,"name":"ConnexPay","stage":null},"status":"active","active_cards":3,"money_in":0.0,"money_out":-0.0,"balance":2251.15,"begin_balance":2251.15,"settled":0.0,"refund":0.0,"pending":0.0,"reversed_amount":0.0,"fx_fee":0.0,"cross_border_fee":0.0,"decline_fee":0.0,"spend":-0.0')
    assert response.text().__contains__('"id":181,"name":"1062075","type":3,"company":{"id":172,"name":"golden company","owner_type":"client"},"provider":{"id":2,"name":"ConnexPay","stage":null},"status":"active","active_cards":2,"money_in":0.0,"money_out":-0.0,"balance":2250.94,"begin_balance":2250.94,"settled":0.0,"refund":0.0,"pending":0.0,"reversed_amount":0.0,"fx_fee":0.0,"cross_border_fee":0.0,"decline_fee":0.0,"spend":-0.0')
    assert response.text().__contains__('"id":19,"name":"2000019","type":6,"company":null,"provider":{"id":2,"name":"ConnexPay","stage":null},"status":"active","active_cards":0,"money_in":0.0,"money_out":-0.0,"balance":2172.3,"begin_balance":2172.3,"settled":0.0,"refund":0.0,"pending":0.0,"reversed_amount":0.0,"fx_fee":0.0,"cross_border_fee":0.0,"decline_fee":0.0,"spend":-0.0')
    assert response.text().__contains__('"id":178,"name":"1057766","type":3,"company":{"id":169,"name":"green company","owner_type":"client"},"provider":{"id":2,"name":"ConnexPay","stage":null},"status":"active","active_cards":2,"money_in":0.0,"money_out":-0.0,"balance":1937.52,"begin_balance":1937.52,"settled":0.0,"refund":0.0,"pending":0.0,"reversed_amount":0.0,"fx_fee":0.0,"cross_border_fee":0.0,"decline_fee":0.0,"spend":-0.0')


@allure.title('Admin account list filter by status inactive')
def test_admin_account_list_filter_by_status_inactive(auth_token, api_request_context: APIRequestContext) -> None:
    headers = {
        'Authorization': f"Token {auth_token}"
    }
    response = api_request_context.get(
        '/api/admin/account?status=inactive&page=2&date_start=2024-05-18&date_end=2024-05-19', headers=headers
    )

    assert response.status == 200
    assert response.text().__contains__('"next":"https://dev.api.devhost.io/api/admin/account?date_end=2024-05-19&date_start=2024-05-18&page=3&status=inactive","previous":"https://dev.api.devhost.io/api/admin/account?date_end=2024-05-19&date_start=2024-05-18&status=inactive","results":{"total_sum":{"money_in":0.0,"money_out":-0.0,"balance":246.0,"begin_balance":246.0,"settled":0.0,"refund":0.0,"pending":0.0,"reversed_amount":0.0,"fx_fee":0.0,"cross_border_fee":0.0,"decline_fee":0.0,"spend":-0.0}')
    assert response.text().__contains__('"id":798,"name":null,"type":3,"company":{"id":793,"name":"nkxLTWGQfJ gBkp","owner_type":"client"},"provider":null,"status":"inactive","active_cards":0,"money_in":0.0,"money_out":-0.0,"balance":0.0,"begin_balance":0.0,"settled":0.0,"refund":0.0,"pending":0.0,"reversed_amount":0.0,"fx_fee":0.0,"cross_border_fee":0.0,"decline_fee":0.0,"spend":-0.0}')


@allure.title('Admin account list filter by company')
def test_admin_account_list_filter_by_company(auth_token, api_request_context: APIRequestContext) -> None:
    headers = {
        'Authorization': f"Token {auth_token}"
    }
    response = api_request_context.get(
        '/api/admin/account?company=346&date_start=2024-05-18&date_end=2024-05-19', headers=headers
    )

    assert response.status == 200
    assert response.text() == '{"count":1,"next":null,"previous":null,"results":{"total_sum":{"money_in":0.0,"money_out":-0.0,"balance":0.0,"begin_balance":0.0,"settled":0.0,"refund":0.0,"pending":0.0,"reversed_amount":0.0,"fx_fee":0.0,"cross_border_fee":0.0,"decline_fee":0.0,"spend":-0.0},"data":[{"id":351,"name":null,"type":3,"company":{"id":346,"name":"rt56756y fgretergt","owner_type":"client"},"provider":null,"status":"inactive","active_cards":0,"money_in":0.0,"money_out":-0.0,"balance":0.0,"begin_balance":0.0,"settled":0.0,"refund":0.0,"pending":0.0,"reversed_amount":0.0,"fx_fee":0.0,"cross_border_fee":0.0,"decline_fee":0.0,"spend":-0.0}]}}'


@allure.title('Admin account list filter by company owner')
def test_admin_account_list_filter_by_company_owner(auth_token, api_request_context: APIRequestContext) -> None:
    headers = {
        'Authorization': f"Token {auth_token}"
    }
    response = api_request_context.get(
        '/api/admin/account?company_owner_type=client&date_start=2024-05-18&date_end=2024-05-19', headers=headers
    )

    assert response.status == 200
    assert response.text().__contains__('"next":"https://dev.api.devhost.io/api/admin/account?company_owner_type=client&date_end=2024-05-19&date_start=2024-05-18&page=2","previous":null,"results":{"total_sum":{"money_in":0.0,"money_out":-0.0,"balance":')
    assert response.text().__contains__('"begin_balance":')
    assert response.text().__contains__('"settled":980.0,"refund":160.0,"pending":810.0,"reversed_amount":183.0,"fx_fee":7.17,"cross_border_fee":14.47,"decline_fee":4.5,"spend":')
    assert response.text().__contains__('"data":[{"id":4,"name":"1021481","type":3,"company":{"id":1,"name":"MTS","owner_type":"client"},"provider":{"id":2,"name":"ConnexPay","stage":null}')
    assert response.text().__contains__('"id":9,"name":"1015104","type":3,"company":{"id":6,"name":"ConnCompany","owner_type":"client"},"provider":{"id":2,"name":"ConnexPay","stage":null},"status":"active","active_cards":20,"money_in":0.0,"money_out":-0.0,"balance":2929.3599999999715,"begin_balance":2929.3599999999715,"settled":0.0,"refund":0.0,"pending":0.0,"reversed_amount":0.0,"fx_fee":0.0,"cross_border_fee":0.0,"decline_fee":0.0,"spend":-0.0')
    assert response.text().__contains__('"id":179,"name":"1041407","type":3,"company":{"id":170,"name":"grey company","owner_type":"client"},"provider":{"id":2,"name":"ConnexPay","stage":null},"status":"active","active_cards":2,"money_in":0.0,"money_out":-0.0,"balance":2459.0,"begin_balance":2560.96,"settled":55.0,"refund":0.0,"pending":46.0,"reversed_amount":0.0,"fx_fee":0.0,"cross_border_fee":0.96,"decline_fee":0.0,"spend":-101.96')
    assert response.text().__contains__('"id":7,"name":"1062148","type":3,"company":{"id":4,"name":"Tesla","owner_type":"client"},"provider":{"id":2,"name":"ConnexPay","stage":null},"status":"active","active_cards":5,"money_in":0.0,"money_out":-0.0,"balance":2265.0,"begin_balance":2265.0,"settled":0.0,"refund":0.0,"pending":0.0,"reversed_amount":0.0,"fx_fee":0.0,"cross_border_fee":0.0,"decline_fee":0.0,"spend":-0.0')
    assert response.text().__contains__('"id":182,"name":"1025391","type":3,"company":{"id":173,"name":"black company","owner_type":"client"},"provider":{"id":2,"name":"ConnexPay","stage":null},"status":"active","active_cards":3,"money_in":0.0,"money_out":-0.0,"balance":2098.65,"begin_balance":2251.15,"settled":115.0,"refund":48.0,"pending":84.0,"reversed_amount":61.0,"fx_fee":0.0,"cross_border_fee":0.0,"decline_fee":1.5,"spend":-152.5')
    assert response.text().__contains__('"id":181,"name":"1062075","type":3,"company":{"id":172,"name":"golden company","owner_type":"client"},"provider":{"id":2,"name":"ConnexPay","stage":null},"status":"active","active_cards":2,"money_in":0.0,"money_out":-0.0,"balance":2026.9,"begin_balance":2250.94,"settled":22.0,"refund":16.0,"pending":214.0,"reversed_amount":0.0,"fx_fee":0.93,"cross_border_fee":3.11,"decline_fee":0.0,"spend":-224.04000000000002')
    assert response.text().__contains__('"id":177,"name":"1026728","type":3,"company":{"id":168,"name":"red company","owner_type":"client"},"provider":{"id":2,"name":"ConnexPay","stage":null},"status":"active","active_cards":2,"money_in":0.0,"money_out":-0.0,"balance":1904.7399999999998,"begin_balance":2434.7,"settled":355.0,"refund":48.0,"pending":214.0,"reversed_amount":61.0,"fx_fee":2.94,"cross_border_fee":4.52,"decline_fee":1.5,"spend":-529.96')
    assert response.text().__contains__('"id":178,"name":"1057766","type":3,"company":{"id":169,"name":"green company","owner_type":"client"},"provider":{"id":2,"name":"ConnexPay","stage":null},"status":"active","active_cards":2,"money_in":0.0,"money_out":-0.0,"balance":1767.1599999999999,"begin_balance":1937.52,"settled":0.0,"refund":0.0,"pending":168.0,"reversed_amount":0.0,"fx_fee":0.93,"cross_border_fee":1.43,"decline_fee":0.0,"spend":-170.36')
    assert response.text().__contains__('"id":138,"name":"1018850","type":3,"company":{"id":129,"name":"test do not change","owner_type":"client"},"provider":{"id":2,"name":"ConnexPay","stage":null},"status":"active","active_cards":28,"money_in":0.0,"money_out":-0.0,"balance":1005.1500000000001,"begin_balance":1005.1500000000001,"settled":0.0,"refund":0.0,"pending":0.0,"reversed_amount":0.0,"fx_fee":0.0,"cross_border_fee":0.0,"decline_fee":0.0,"spend":-0.0')


@allure.title('Admin account list filter by provider')
def test_admin_account_list_filter_by_provider(auth_token, api_request_context: APIRequestContext) -> None:
    headers = {
        'Authorization': f"Token {auth_token}"
    }
    response = api_request_context.get(
        'api/admin/account?provider=2&date_start=2024-05-18&date_end=2024-05-18', headers=headers
    )

    assert response.status == 200
    assert response.text().__contains__('"next":"https://dev.api.devhost.io/api/admin/account?date_end=2024-05-18&date_start=2024-05-18&page=2&provider=2","previous":null,"results":{"total_sum":{"money_in":0.0,"money_out":-0.0,"balance":-310599.81999999995,"begin_balance":-310599.81999999995,"settled":0.0,"refund":0.0,"pending":0.0,"reversed_amount":0.0,"fx_fee":0.0,"cross_border_fee":0.0,"decline_fee":0.0,"spend":-0.0},"data":[{"id":4,"name":"1021481","type":3,"company":{"id":1,"name":"MTS","owner_type":"client"},"provider":{"id":2,"name":"ConnexPay","stage":null}')
    assert response.text().__contains__('"money_in":0.0,"money_out":-0.0,"balance":')
    assert response.text().__contains__('"begin_balance":')
    assert response.text().__contains__('{"id":179,"name":"1041407","type":3,"company":{"id":170,"name":"grey company","owner_type":"client"}')


@allure.title('Admin account list filter by type')
def test_admin_account_list_filter_by_type(auth_token, api_request_context: APIRequestContext) -> None:
    headers = {
        'Authorization': f"Token {auth_token}"
    }
    response = api_request_context.get(
        '/api/admin/account?type=1&date_start=2024-05-18&date_end=2024-05-18', headers=headers
    )

    assert response.status == 200
    assert response.text() == '{"count":3,"next":null,"previous":null,"results":{"total_sum":{"money_in":0.0,"money_out":-0.0,"balance":94197.98999999999,"begin_balance":94197.98999999999,"settled":0.0,"refund":0.0,"pending":0.0,"reversed_amount":0.0,"fx_fee":0.0,"cross_border_fee":0.0,"decline_fee":0.0,"spend":-0.0},"data":[{"id":2,"name":"1000002","type":1,"company":null,"provider":{"id":1,"name":"Core Pay","stage":null},"status":"active","active_cards":0,"money_in":0.0,"money_out":-0.0,"balance":93103.0,"begin_balance":93103.0,"settled":0.0,"refund":0.0,"pending":0.0,"reversed_amount":0.0,"fx_fee":0.0,"cross_border_fee":0.0,"decline_fee":0.0,"spend":-0.0},{"id":11,"name":"2000011","type":1,"company":null,"provider":{"id":2,"name":"ConnexPay","stage":null},"status":"active","active_cards":0,"money_in":0.0,"money_out":-0.0,"balance":1094.989999999998,"begin_balance":1094.989999999998,"settled":0.0,"refund":0.0,"pending":0.0,"reversed_amount":0.0,"fx_fee":0.0,"cross_border_fee":0.0,"decline_fee":0.0,"spend":-0.0},{"id":847,"name":"5000002","type":1,"company":null,"provider":{"id":5,"name":"Qolo","stage":null},"status":"active","active_cards":0,"money_in":0.0,"money_out":-0.0,"balance":0.0,"begin_balance":0.0,"settled":0.0,"refund":0.0,"pending":0.0,"reversed_amount":0.0,"fx_fee":0.0,"cross_border_fee":0.0,"decline_fee":0.0,"spend":-0.0}]}}'


@allure.title('Admin account list search')
def test_admin_account_list_search(auth_token, api_request_context: APIRequestContext) -> None:
    headers = {
        'Authorization': f"Token {auth_token}"
    }
    response = api_request_context.get(
        '/api/admin/account?search=Tesla&date_start=2024-05-18&date_end=2024-05-19', headers=headers
    )

    assert response.status == 200
    assert response.text() == '{"count":2,"next":null,"previous":null,"results":{"total_sum":{"money_in":0.0,"money_out":-0.0,"balance":2265.0,"begin_balance":2265.0,"settled":0.0,"refund":0.0,"pending":0.0,"reversed_amount":0.0,"fx_fee":0.0,"cross_border_fee":0.0,"decline_fee":0.0,"spend":-0.0},"data":[{"id":7,"name":"1062148","type":3,"company":{"id":4,"name":"Tesla","owner_type":"client"},"provider":{"id":2,"name":"ConnexPay","stage":null},"status":"active","active_cards":5,"money_in":0.0,"money_out":-0.0,"balance":2265.0,"begin_balance":2265.0,"settled":0.0,"refund":0.0,"pending":0.0,"reversed_amount":0.0,"fx_fee":0.0,"cross_border_fee":0.0,"decline_fee":0.0,"spend":-0.0},{"id":24,"name":"1071877","type":3,"company":{"id":15,"name":"The Tesla","owner_type":"client"},"provider":{"id":2,"name":"ConnexPay","stage":null},"status":"active","active_cards":0,"money_in":0.0,"money_out":-0.0,"balance":0.0,"begin_balance":0.0,"settled":0.0,"refund":0.0,"pending":0.0,"reversed_amount":0.0,"fx_fee":0.0,"cross_border_fee":0.0,"decline_fee":0.0,"spend":-0.0}]}}'


@allure.title('Admin account list ordering begin_balance')
def test_admin_account_list_ordering_begin_balance(auth_token, api_request_context: APIRequestContext) -> None:
    headers = {
        'Authorization': f"Token {auth_token}"
    }
    response = api_request_context.get(
        '/api/admin/account?ordering=begin_balance&date_start=2024-05-18&date_end=2024-05-19', headers=headers
    )

    assert response.status == 200
    assert response.text().__contains__('"next":"https://dev.api.devhost.io/api/admin/account?date_end=2024-05-19&date_start=2024-05-18&ordering=begin_balance&page=2","previous":null,"results":{"total_sum":{"money_in":0.0,"money_out":-0.0'),('"settled":980.0,"refund":160.0,"pending":810.0,"reversed_amount":183.0,"fx_fee":7.17,"cross_border_fee":14.47,"decline_fee":4.5,"spend":-1656.14')
    assert response.text().__contains__('{"id":865,"name":null,"type":3,"company":{"id":850,"name":"mhywBE","owner_type":"client"},"provider":null,"status":"inactive","active_cards":0,"money_in":0.0,"money_out":-0.0,"balance":0.0,"begin_balance":0.0,"settled":0.0,"refund":0.0,"pending":0.0,"reversed_amount":0.0,"fx_fee":0.0,"cross_border_fee":0.0,"decline_fee":0.0,"spend":-0.0}')
    assert response.text().__contains__('{"id":750,"name":"2059824","type":3,"company":{"id":745,"name":"dnmCTvzJ","owner_type":"client"},"provider":{"id":2,"name":"ConnexPay","stage":null},"status":"active","active_cards":0,"money_in":0.0,"money_out":-0.0,"balance":0.0,"begin_balance":0.0,"settled":0.0,"refund":0.0,"pending":0.0,"reversed_amount":0.0,"fx_fee":0.0,"cross_border_fee":0.0,"decline_fee":0.0,"spend":-0.0}')
    assert response.text().__contains__('{"id":818,"name":"2068729","type":3,"company":{"id":805,"name":"tttt","owner_type":"client"},"provider":{"id":2,"name":"ConnexPay","stage":null},"status":"active","active_cards":0,"money_in":0.0,"money_out":-0.0,"balance":0.0,"begin_balance":0.0,"settled":0.0,"refund":0.0,"pending":0.0,"reversed_amount":0.0,"fx_fee":0.0,"cross_border_fee":0.0,"decline_fee":0.0,"spend":-0.0}')


@allure.title('Admin account list ordering money in')
def test_admin_account_list_ordering_money_in(auth_token, api_request_context: APIRequestContext) -> None:
    headers = {
        'Authorization': f"Token {auth_token}"
    }
    response = api_request_context.get(
        '/api/admin/account?ordering=money_in&date_start=2024-05-18&date_end=2024-05-19', headers=headers
    )

    assert response.status == 200
    assert response.text().__contains__('"next":"https://dev.api.devhost.io/api/admin/account?date_end=2024-05-19&date_start=2024-05-18&ordering=money_in&page=2","previous":null,"results":{"total_sum":{"money_in":0.0,"money_out":-0.0'),('"settled":980.0,"refund":160.0,"pending":810.0,"reversed_amount":183.0,"fx_fee":7.17,"cross_border_fee":14.47,"decline_fee":4.5,"spend":-1656.14},"data":[{"id":4,"name":"1021481","type":3,"company":{"id":1,"name":"MTS","owner_type":"client"},"provider":{"id":2,"name":"ConnexPay","stage":null}')
    assert response.text().__contains__('"money_in":0.0,"money_out":-0.0,"balance":'),('"begin_balance":')
    assert response.text().__contains__('"settled":0.0,"refund":0.0,"pending":0.0,"reversed_amount":0.0,"fx_fee":0.0,"cross_border_fee":0.0,"decline_fee":0.0,"spend":-0.0')
    assert response.text().__contains__('{"id":178,"name":"1057766","type":3,"company":{"id":169,"name":"green company","owner_type":"client"},"provider":{"id":2,"name":"ConnexPay","stage":null},"status":"active","active_cards":2,"money_in":0.0,"money_out":-0.0,"balance":1767.1599999999999,"begin_balance":1937.52,"settled":0.0,"refund":0.0,"pending":168.0,"reversed_amount":0.0,"fx_fee":0.93,"cross_border_fee":1.43,"decline_fee":0.0,"spend":-170.36}')
    assert response.text().__contains__('{"id":865,"name":null,"type":3,"company":{"id":850,"name":"mhywBE","owner_type":"client"},"provider":null,"status":"inactive","active_cards":0,"money_in":0.0,"money_out":-0.0,"balance":0.0,"begin_balance":0.0,"settled":0.0,"refund":0.0,"pending":0.0,"reversed_amount":0.0,"fx_fee":0.0,"cross_border_fee":0.0,"decline_fee":0.0,"spend":-0.0}')


@allure.title('Admin account list ordering -money in')
def test_admin_account_list_ordering__money_in(auth_token, api_request_context: APIRequestContext) -> None:
    headers = {
        'Authorization': f"Token {auth_token}"
    }
    response = api_request_context.get(
        '/api/admin/account?ordering=-money_in&date_start=2024-05-18&date_end=2024-05-19', headers=headers
    )

    assert response.status == 200
    assert response.text().__contains__('"next":"https://dev.api.devhost.io/api/admin/account?date_end=2024-05-19&date_start=2024-05-18&ordering=-money_in&page=2","previous":null,"results":{"total_sum":{"money_in":0.0,"money_out":-0.0,"balance":')
    assert response.text().__contains__('"begin_balance":')
    assert response.text().__contains__('"settled":980.0,"refund":160.0,"pending":810.0,"reversed_amount":183.0,"fx_fee":7.17,"cross_border_fee":14.47,"decline_fee":4.5,"spend":')
    assert response.text().__contains__('"money_in":0.0,"money_out":-0.0,"balance"')
    assert response.text().__contains__('"begin_balance":')
    assert response.text().__contains__('"settled":0.0,"refund":0.0,"pending":0.0,"reversed_amount":0.0,"fx_fee":0.0,"cross_border_fee":0.0,"decline_fee":0.0,"spend":-0.0')
    assert response.text().__contains__('{"id":178,"name":"1057766","type":3,"company":{"id":169,"name":"green company","owner_type":"client"},"provider":{"id":2,"name":"ConnexPay","stage":null},"status":"active","active_cards":2,"money_in":0.0,"money_out":-0.0,"balance":1767.1599999999999,"begin_balance":1937.52,"settled":0.0,"refund":0.0,"pending":168.0,"reversed_amount":0.0,"fx_fee":0.93,"cross_border_fee":1.43,"decline_fee":0.0,"spend":-170.36}')
    assert response.text().__contains__('{"id":865,"name":null,"type":3,"company":{"id":850,"name":"mhywBE","owner_type":"client"},"provider":null,"status":"inactive","active_cards":0,"money_in":0.0,"money_out":-0.0,"balance":0.0,"begin_balance":0.0,"settled":0.0,"refund":0.0,"pending":0.0,"reversed_amount":0.0,"fx_fee":0.0,"cross_border_fee":0.0,"decline_fee":0.0,"spend":-0.0}')


@allure.title('Admin account list ordering money out')
def test_admin_account_list_ordering_money_out(auth_token, api_request_context: APIRequestContext) -> None:
    headers = {
        'Authorization': f"Token {auth_token}"
    }
    response = api_request_context.get(
        '/api/admin/account?ordering=money_out&date_start=2024-05-18&date_end=2024-05-19', headers=headers
    )

    assert response.status == 200
    assert response.text().__contains__('"next":"https://dev.api.devhost.io/api/admin/account?date_end=2024-05-19&date_start=2024-05-18&ordering=money_out&page=2","previous":null,"results":{"total_sum":{"money_in":0.0,"money_out":-0.0'),('"settled":980.0,"refund":160.0,"pending":810.0,"reversed_amount":183.0,"fx_fee":7.17,"cross_border_fee":14.47,"decline_fee":4.5,"spend":-1656.14},"data":[{"id":4,"name":"1021481","type":3,"company":{"id":1,"name":"MTS","owner_type":"client"},"provider":{"id":2,"name":"ConnexPay","stage":null}')
    assert response.text().__contains__('{"id":178,"name":"1057766","type":3,"company":{"id":169,"name":"green company","owner_type":"client"},"provider":{"id":2,"name":"ConnexPay","stage":null},"status":"active","active_cards":2,"money_in":0.0,"money_out":-0.0,"balance":1767.1599999999999,"begin_balance":1937.52,"settled":0.0,"refund":0.0,"pending":168.0,"reversed_amount":0.0,"fx_fee":0.93,"cross_border_fee":1.43,"decline_fee":0.0,"spend":-170.36}')
    assert response.text().__contains__('{"id":865,"name":null,"type":3,"company":{"id":850,"name":"mhywBE","owner_type":"client"},"provider":null,"status":"inactive","active_cards":0,"money_in":0.0,"money_out":-0.0,"balance":0.0,"begin_balance":0.0,"settled":0.0,"refund":0.0,"pending":0.0,"reversed_amount":0.0,"fx_fee":0.0,"cross_border_fee":0.0,"decline_fee":0.0,"spend":-0.0}')


@allure.title('Admin account list ordering by spend')
def test_admin_account_list_ordering_by_spend(auth_token, api_request_context: APIRequestContext) -> None:
    headers = {
        'Authorization': f"Token {auth_token}"
    }
    response = api_request_context.get(
        '/api/admin/account?ordering=spend&date_start=2024-05-18&date_end=2024-05-19', headers=headers
    )

    assert response.status == 200
    assert response.text().__contains__('"next":"https://dev.api.devhost.io/api/admin/account?date_end=2024-05-19&date_start=2024-05-18&ordering=spend&page=2","previous":null,"results":{"total_sum":{"money_in":0.0,"money_out":-0.0'),('"settled":980.0,"refund":160.0,"pending":810.0,"reversed_amount":183.0,"fx_fee":7.17,"cross_border_fee":14.47,"decline_fee":4.5,"spend":-1656.14},"data":[{"id":177,"name":"1026728","type":3,"company":{"id":168,"name":"red company","owner_type":"client"},"provider":{"id":2,"name":"ConnexPay","stage":null},"status":"active","active_cards":2,"money_in":0.0,"money_out":-0.0,"balance":1904.7399999999998,"begin_balance":2434.7,"settled":355.0,"refund":48.0,"pending":214.0,"reversed_amount":61.0,"fx_fee":2.94,"cross_border_fee":4.52,"decline_fee":1.5,"spend":-529.96},{"id":180,"name":"1029366","type":3,"company":{"id":171,"name":"ruby rose","owner_type":"client"},"provider":{"id":2,"name":"ConnexPay","stage":null},"status":"active","active_cards":2,"money_in":0.0,"money_out":-0.0,"balance":467.9799999999999,"begin_balance":750.9399999999999,"settled":278.0,"refund":0.0,"pending":0.0,"reversed_amount":0.0,"fx_fee":2.23,"cross_border_fee":2.73,"decline_fee":0.0,"spend":-282.96000000000004},{"id":181,"name":"1062075","type":3,"company":{"id":172,"name":"golden company","owner_type":"client"},"provider":{"id":2,"name":"ConnexPay","stage":null},"status":"active","active_cards":2,"money_in":0.0,"money_out":-0.0,"balance":2026.9,"begin_balance":2250.94,"settled":22.0,"refund":16.0,"pending":214.0,"reversed_amount":0.0,"fx_fee":0.93,"cross_border_fee":3.11,"decline_fee":0.0,"spend":-224.04000000000002},{"id":176,"name":"1047836","type":3,"company":{"id":167,"name":"white company","owner_type":"client"},"provider":{"id":2,"name":"ConnexPay","stage":null},"status":"active","active_cards":4,"money_in":0.0,"money_out":-0.0,"balance":615.9599999999999,"begin_balance":810.3199999999999,"settled":155.0,"refund":48.0,"pending":84.0,"reversed_amount":61.0,"fx_fee":0.14,"cross_border_fee":1.72,"decline_fee":1.5,"spend":-194.35999999999999},{"id":178,"name":"1057766","type":3,"company":{"id":169,"name":"green company","owner_type":"client"},"provider":{"id":2,"name":"ConnexPay","stage":null},"status":"active","active_cards":2,"money_in":0.0,"money_out":-0.0,"balance":1767.1599999999999,"begin_balance":1937.52,"settled":0.0,"refund":0.0,"pending":168.0,"reversed_amount":0.0,"fx_fee":0.93,"cross_border_fee":1.43,"decline_fee":0.0,"spend":-170.36},{"id":182,"name":"1025391","type":3,"company":{"id":173,"name":"black company","owner_type":"client"},"provider":{"id":2,"name":"ConnexPay","stage":null},"status":"active","active_cards":3,"money_in":0.0,"money_out":-0.0,"balance":2098.65,"begin_balance":2251.15,"settled":115.0,"refund":48.0,"pending":84.0,"reversed_amount":61.0,"fx_fee":0.0,"cross_border_fee":0.0,"decline_fee":1.5,"spend":-152.5},{"id":179,"name":"1041407","type":3,"company":{"id":170,"name":"grey company","owner_type":"client"},"provider":{"id":2,"name":"ConnexPay","stage":null},"status":"active","active_cards":2,"money_in":0.0,"money_out":-0.0,"balance":2459.0,"begin_balance":2560.96,"settled":55.0,"refund":0.0,"pending":46.0,"reversed_amount":0.0,"fx_fee":0.0,"cross_border_fee":0.96,"decline_fee":0.0,"spend":-101.96},{"id":9,"name":"1015104","type":3,"company":{"id":6,"name":"ConnCompany","owner_type":"client"},"provider":{"id":2,"name":"ConnexPay","stage":null},"status":"active","active_cards":30,"money_in":0.0,"money_out":-0.0,"balance":2929.3599999999715,"begin_balance":2929.3599999999715,"settled":0.0,"refund":0.0,"pending":0.0,"reversed_amount":0.0,"fx_fee":0.0,"cross_border_fee":0.0,"decline_fee":0.0,"spend":-0.0},{"id":8,"name":"1083293","type":3,"company":{"id":5,"name":"New company 1","owner_type":"client"},"provider":{"id":2,"name":"ConnexPay","stage":null},"status":"active","active_cards":1,"money_in":0.0,"money_out":-0.0,"balance":90.0,"begin_balance":90.0,"settled":0.0,"refund":0.0,"pending":0.0,"reversed_amount":0.0,"fx_fee":0.0,"cross_border_fee":0.0,"decline_fee":0.0,"spend":-0.0},{"id":5,"name":"1038841","type":3,"company":{"id":2,"name":"Beeline","owner_type":"client"},"provider":{"id":2,"name":"ConnexPay","stage":null},"status":"active","active_cards":0,"money_in":0.0,"money_out":-0.0,"balance":100.0,"begin_balance":100.0,"settled":0.0,"refund":0.0,"pending":0.0,"reversed_amount":0.0,"fx_fee":0.0,"cross_border_fee":0.0,"decline_fee":0.0,"spend":-0.0},{"id":17,"name":"2000017","type":5,"company":null,"provider":{"id":2,"name":"ConnexPay","stage":null},"status":"active","active_cards":0,"money_in":0.0,"money_out":-0.0,"balance":0.0,"begin_balance":0.0,"settled":0.0,"refund":0.0,"pending":0.0,"reversed_amount":0.0,"fx_fee":0.0,"cross_border_fee":0.0,"decline_fee":0.0,"spend":-0.0},{"id":18,"name":"2000018","type":2,"company":null,"provider":{"id":2,"name":"ConnexPay","stage":null},"status":"active","active_cards":0,"money_in":0.0,"money_out":-0.0,"balance":-500208.0,"begin_balance":-500208.0,"settled":0.0,"refund":0.0,"pending":0.0,"reversed_amount":0.0,"fx_fee":0.0,"cross_border_fee":0.0,"decline_fee":0.0,"spend":-0.0},{"id":19,"name":"2000019","type":6,"company":null,"provider":{"id":2,"name":"ConnexPay","stage":null},"status":"active","active_cards":0,"money_in":0.0,"money_out":-0.0,"balance":2172.3,"begin_balance":2172.3,"settled":0.0,"refund":0.0,"pending":0.0,"reversed_amount":0.0,"fx_fee":0.0,"cross_border_fee":0.0,"decline_fee":0.0,"spend":-0.0},{"id":20,"name":"1015919","type":3,"company":{"id":11,"name":"123","owner_type":"client"},"provider":{"id":1,"name":"Core Pay","stage":null},"status":"inactive","active_cards":0,"money_in":0.0,"money_out":-0.0,"balance":0.0,"begin_balance":0.0,"settled":0.0,"refund":0.0,"pending":0.0,"reversed_amount":0.0,"fx_fee":0.0,"cross_border_fee":0.0,"decline_fee":0.0,"spend":-0.0},{"id":15,"name":"1012858","type":3,"company":{"id":9,"name":"test2","owner_type":"own"},"provider":{"id":1,"name":"Core Pay","stage":null},"status":"active","active_cards":0,"money_in":0.0,"money_out":-0.0,"balance":53.0,"begin_balance":53.0,"settled":0.0,"refund":0.0,"pending":0.0,"reversed_amount":0.0,"fx_fee":0.0,"cross_border_fee":0.0,"decline_fee":0.0,"spend":-0.0},{"id":14,"name":"1059798","type":3,"company":{"id":8,"name":"test1","owner_type":"client"},"provider":{"id":1,"name":"Core Pay","stage":null},"status":"active","active_cards":0,"money_in":0.0,"money_out":-0.0,"balance":220.0,"begin_balance":220.0,"settled":0.0,"refund":0.0,"pending":0.0,"reversed_amount":0.0,"fx_fee":0.0,"cross_border_fee":0.0,"decline_fee":0.0,"spend":-0.0},{"id":7,"name":"1062148","type":3,"company":{"id":4,"name":"Tesla","owner_type":"client"},"provider":{"id":2,"name":"ConnexPay","stage":null},"status":"active","active_cards":5,"money_in":0.0,"money_out":-0.0,"balance":2265.0,"begin_balance":2265.0,"settled":0.0,"refund":0.0,"pending":0.0,"reversed_amount":0.0,"fx_fee":0.0,"cross_border_fee":0.0,"decline_fee":0.0,"spend":-0.0},{"id":24,"name":"1071877","type":3,"company":{"id":15,"name":"The Tesla","owner_type":"client"},"provider":{"id":2,"name":"ConnexPay","stage":null},"status":"inactive","active_cards":0,"money_in":0.0,"money_out":-0.0,"balance":0.0,"begin_balance":0.0,"settled":0.0,"refund":0.0,"pending":0.0,"reversed_amount":0.0,"fx_fee":0.0,"cross_border_fee":0.0,"decline_fee":0.0,"spend":-0.0},{"id":25,"name":"1087426","type":3,"company":{"id":16,"name":"1234","owner_type":"client"},"provider":{"id":1,"name":"Core Pay","stage":null},"status":"inactive","active_cards":0,"money_in":0.0,"money_out":-0.0,"balance":0.0,"begin_balance":0.0,"settled":0.0,"refund":0.0,"pending":0.0,"reversed_amount":0.0,"fx_fee":0.0,"cross_border_fee":0.0,"decline_fee":0.0,"spend":-0.0},{"id":26,"name":"1094765","type":3,"company":{"id":17,"name":"1231","owner_type":"client"},"provider":{"id":1,"name":"Core Pay","stage":null},"status":"inactive","active_cards":0,"money_in":0.0,"money_out":-0.0,"balance":0.0,"begin_balance":0.0,"settled":0.0,"refund":0.0,"pending":0.0,"reversed_amount":0.0,"fx_fee":0.0,"cross_border_fee":0.0,"decline_fee":0.0,"spend":-0.0},{"id":27,"name":"1054195","type":3,"company":{"id":18,"name":"1232","owner_type":"client"},"provider":{"id":1,"name":"Core Pay","stage":null},"status":"inactive","active_cards":0,"money_in":0.0,"money_out":-0.0,"balance":0.0,"begin_balance":0.0,"settled":0.0,"refund":0.0,"pending":0.0,"reversed_amount":0.0,"fx_fee":0.0,"cross_border_fee":0.0,"decline_fee":0.0,"spend":-0.0},{"id":30,"name":"1091129","type":3,"company":{"id":21,"name":"ComapnyCreated","owner_type":"client"},"provider":{"id":1,"name":"Core Pay","stage":null},"status":"inactive","active_cards":0,"money_in":0.0,"money_out":-0.0,"balance":0.0,"begin_balance":0.0,"settled":0.0,"refund":0.0,"pending":0.0,"reversed_amount":0.0,"fx_fee":0.0,"cross_border_fee":0.0,"decline_fee":0.0,"spend":-0.0},{"id":32,"name":"1012677","type":3,"company":{"id":23,"name":"Referral","owner_type":"client"},"provider":{"id":1,"name":"Core Pay","stage":null},"status":"inactive","active_cards":0,"money_in":0.0,"money_out":-0.0,"balance":0.0,"begin_balance":0.0,"settled":0.0,"refund":0.0,"pending":0.0,"reversed_amount":0.0,"fx_fee":0.0,"cross_border_fee":0.0,"decline_fee":0.0,"spend":-0.0},{"id":33,"name":"1069665","type":3,"company":{"id":24,"name":"SomeReferee","owner_type":"client"},"provider":{"id":1,"name":"Core Pay","stage":null},"status":"inactive","active_cards":0,"money_in":0.0,"money_out":-0.0,"balance":0.0,"begin_balance":0.0,"settled":0.0,"refund":0.0,"pending":0.0,"reversed_amount":0.0,"fx_fee":0.0,"cross_border_fee":0.0,"decline_fee":0.0,"spend":-0.0},{"id":23,"name":"1096379","type":3,"company":{"id":14,"name":"GreatTraffic","owner_type":"client"},"provider":{"id":1,"name":"Core Pay","stage":null},"status":"inactive","active_cards":0,"money_in":0.0,"money_out":-0.0,"balance":0.0,"begin_balance":0.0,"settled":0.0,"refund":0.0,"pending":0.0,"reversed_amount":0.0,"fx_fee":0.0,"cross_border_fee":0.0,"decline_fee":0.0,"spend":-0.0}]}}')


@allure.title('Admin account list ordering by -spend')
def test_admin_account_list_ordering_by__spend(auth_token, api_request_context: APIRequestContext) -> None:
    headers = {
        'Authorization': f"Token {auth_token}"
    }
    response = api_request_context.get(
        '/api/admin/account?ordering=-spend&date_start=2024-05-18&date_end=2024-05-19', headers=headers
    )

    assert response.status == 200
    assert response.text().__contains__('"next":"https://dev.api.devhost.io/api/admin/account?date_end=2024-05-19&date_start=2024-05-18&ordering=-spend&page=2","previous":null,"results":{"total_sum":{"money_in":0.0,"money_out":-0.0'),('"settled":980.0,"refund":160.0,"pending":810.0,"reversed_amount":183.0,"fx_fee":7.17,"cross_border_fee":14.47,"decline_fee":4.5,"spend":-1656.14},"data":[{"id":4,"name":"1021481","type":3,"company":{"id":1,"name":"MTS","owner_type":"client"},"provider":{"id":2,"name":"ConnexPay","stage":null}')
    assert response.text().__contains__('"money_in":0.0,"money_out":-0.0'),('"settled":0.0,"refund":0.0,"pending":0.0,"reversed_amount":0.0,"fx_fee":0.0,"cross_border_fee":0.0,"decline_fee":0.0,"spend":-0.0},{"id":5,"name":"1038841","type":3,"company":{"id":2,"name":"Beeline","owner_type":"client"},"provider":{"id":2,"name":"ConnexPay","stage":null},"status":"active","active_cards":0,"money_in":0.0,"money_out":-0.0,"balance":100.0,"begin_balance":100.0,"settled":0.0,"refund":0.0,"pending":0.0,"reversed_amount":0.0,"fx_fee":0.0,"cross_border_fee":0.0,"decline_fee":0.0,"spend":-0.0},{"id":6,"name":"1039750","type":3,"company":{"id":3,"name":"Some New Company","owner_type":"client"},"provider":{"id":2,"name":"ConnexPay","stage":null},"status":"active","active_cards":0,"money_in":0.0,"money_out":-0.0,"balance":850.0,"begin_balance":850.0,"settled":0.0,"refund":0.0,"pending":0.0,"reversed_amount":0.0,"fx_fee":0.0,"cross_border_fee":0.0,"decline_fee":0.0,"spend":-0.0},{"id":7,"name":"1062148","type":3,"company":{"id":4,"name":"Tesla","owner_type":"client"},"provider":{"id":2,"name":"ConnexPay","stage":null},"status":"active","active_cards":5,"money_in":0.0,"money_out":-0.0,"balance":2265.0,"begin_balance":2265.0,"settled":0.0,"refund":0.0,"pending":0.0,"reversed_amount":0.0,"fx_fee":0.0,"cross_border_fee":0.0,"decline_fee":0.0,"spend":-0.0},{"id":8,"name":"1083293","type":3,"company":{"id":5,"name":"New company 1","owner_type":"client"},"provider":{"id":2,"name":"ConnexPay","stage":null},"status":"active","active_cards":1,"money_in":0.0,"money_out":-0.0,"balance":90.0,"begin_balance":90.0,"settled":0.0,"refund":0.0,"pending":0.0,"reversed_amount":0.0,"fx_fee":0.0,"cross_border_fee":0.0,"decline_fee":0.0,"spend":-0.0},{"id":9,"name":"1015104","type":3,"company":{"id":6,"name":"ConnCompany","owner_type":"client"},"provider":{"id":2,"name":"ConnexPay","stage":null},"status":"active","active_cards":30,"money_in":0.0,"money_out":-0.0,"balance":2929.3599999999715,"begin_balance":2929.3599999999715,"settled":0.0,"refund":0.0,"pending":0.0,"reversed_amount":0.0,"fx_fee":0.0,"cross_border_fee":0.0,"decline_fee":0.0,"spend":-0.0},{"id":11,"name":"2000011","type":1,"company":null,"provider":{"id":2,"name":"ConnexPay","stage":null},"status":"active","active_cards":0,"money_in":0.0,"money_out":-0.0,"balance":1094.989999999998,"begin_balance":1094.989999999998,"settled":0.0,"refund":0.0,"pending":0.0,"reversed_amount":0.0,"fx_fee":0.0,"cross_border_fee":0.0,"decline_fee":0.0,"spend":-0.0},{"id":13,"name":"1087313","type":3,"company":{"id":7,"name":"Microsoft","owner_type":"client"},"provider":{"id":1,"name":"Core Pay","stage":null},"status":"active","active_cards":0,"money_in":0.0,"money_out":-0.0,"balance":1234.0,"begin_balance":1234.0,"settled":0.0,"refund":0.0,"pending":0.0,"reversed_amount":0.0,"fx_fee":0.0,"cross_border_fee":0.0,"decline_fee":0.0,"spend":-0.0},{"id":14,"name":"1059798","type":3,"company":{"id":8,"name":"test1","owner_type":"client"},"provider":{"id":1,"name":"Core Pay","stage":null},"status":"active","active_cards":0,"money_in":0.0,"money_out":-0.0,"balance":220.0,"begin_balance":220.0,"settled":0.0,"refund":0.0,"pending":0.0,"reversed_amount":0.0,"fx_fee":0.0,"cross_border_fee":0.0,"decline_fee":0.0,"spend":-0.0},{"id":15,"name":"1012858","type":3,"company":{"id":9,"name":"test2","owner_type":"own"},"provider":{"id":1,"name":"Core Pay","stage":null},"status":"active","active_cards":0,"money_in":0.0,"money_out":-0.0,"balance":53.0,"begin_balance":53.0,"settled":0.0,"refund":0.0,"pending":0.0,"reversed_amount":0.0,"fx_fee":0.0,"cross_border_fee":0.0,"decline_fee":0.0,"spend":-0.0},{"id":17,"name":"2000017","type":5,"company":null,"provider":{"id":2,"name":"ConnexPay","stage":null},"status":"active","active_cards":0,"money_in":0.0,"money_out":-0.0,"balance":0.0,"begin_balance":0.0,"settled":0.0,"refund":0.0,"pending":0.0,"reversed_amount":0.0,"fx_fee":0.0,"cross_border_fee":0.0,"decline_fee":0.0,"spend":-0.0},{"id":18,"name":"2000018","type":2,"company":null,"provider":{"id":2,"name":"ConnexPay","stage":null},"status":"active","active_cards":0,"money_in":0.0,"money_out":-0.0,"balance":-500208.0,"begin_balance":-500208.0,"settled":0.0,"refund":0.0,"pending":0.0,"reversed_amount":0.0,"fx_fee":0.0,"cross_border_fee":0.0,"decline_fee":0.0,"spend":-0.0},{"id":19,"name":"2000019","type":6,"company":null,"provider":{"id":2,"name":"ConnexPay","stage":null},"status":"active","active_cards":0,"money_in":0.0,"money_out":-0.0,"balance":2172.3,"begin_balance":2172.3,"settled":0.0,"refund":0.0,"pending":0.0,"reversed_amount":0.0,"fx_fee":0.0,"cross_border_fee":0.0,"decline_fee":0.0,"spend":-0.0},{"id":20,"name":"1015919","type":3,"company":{"id":11,"name":"123","owner_type":"client"},"provider":{"id":1,"name":"Core Pay","stage":null},"status":"inactive","active_cards":0,"money_in":0.0,"money_out":-0.0,"balance":0.0,"begin_balance":0.0,"settled":0.0,"refund":0.0,"pending":0.0,"reversed_amount":0.0,"fx_fee":0.0,"cross_border_fee":0.0,"decline_fee":0.0,"spend":-0.0},{"id":21,"name":"1019702","type":3,"company":{"id":12,"name":"456","owner_type":"client"},"provider":{"id":1,"name":"Core Pay","stage":null},"status":"inactive","active_cards":0,"money_in":0.0,"money_out":-0.0,"balance":0.0,"begin_balance":0.0,"settled":0.0,"refund":0.0,"pending":0.0,"reversed_amount":0.0,"fx_fee":0.0,"cross_border_fee":0.0,"decline_fee":0.0,"spend":-0.0},{"id":22,"name":"1097981","type":3,"company":{"id":13,"name":"The Great","owner_type":"client"},"provider":{"id":1,"name":"Core Pay","stage":null},"status":"inactive","active_cards":0,"money_in":0.0,"money_out":-0.0,"balance":0.0,"begin_balance":0.0,"settled":0.0,"refund":0.0,"pending":0.0,"reversed_amount":0.0,"fx_fee":0.0,"cross_border_fee":0.0,"decline_fee":0.0,"spend":-0.0},{"id":23,"name":"1096379","type":3,"company":{"id":14,"name":"GreatTraffic","owner_type":"client"},"provider":{"id":1,"name":"Core Pay","stage":null},"status":"inactive","active_cards":0,"money_in":0.0,"money_out":-0.0,"balance":0.0,"begin_balance":0.0,"settled":0.0,"refund":0.0,"pending":0.0,"reversed_amount":0.0,"fx_fee":0.0,"cross_border_fee":0.0,"decline_fee":0.0,"spend":-0.0},{"id":24,"name":"1071877","type":3,"company":{"id":15,"name":"The Tesla","owner_type":"client"},"provider":{"id":2,"name":"ConnexPay","stage":null},"status":"inactive","active_cards":0,"money_in":0.0,"money_out":-0.0,"balance":0.0,"begin_balance":0.0,"settled":0.0,"refund":0.0,"pending":0.0,"reversed_amount":0.0,"fx_fee":0.0,"cross_border_fee":0.0,"decline_fee":0.0,"spend":-0.0},{"id":25,"name":"1087426","type":3,"company":{"id":16,"name":"1234","owner_type":"client"},"provider":{"id":1,"name":"Core Pay","stage":null},"status":"inactive","active_cards":0,"money_in":0.0,"money_out":-0.0,"balance":0.0,"begin_balance":0.0,"settled":0.0,"refund":0.0,"pending":0.0,"reversed_amount":0.0,"fx_fee":0.0,"cross_border_fee":0.0,"decline_fee":0.0,"spend":-0.0},{"id":26,"name":"1094765","type":3,"company":{"id":17,"name":"1231","owner_type":"client"},"provider":{"id":1,"name":"Core Pay","stage":null},"status":"inactive","active_cards":0,"money_in":0.0,"money_out":-0.0,"balance":0.0,"begin_balance":0.0,"settled":0.0,"refund":0.0,"pending":0.0,"reversed_amount":0.0,"fx_fee":0.0,"cross_border_fee":0.0,"decline_fee":0.0,"spend":-0.0},{"id":27,"name":"1054195","type":3,"company":{"id":18,"name":"1232","owner_type":"client"},"provider":{"id":1,"name":"Core Pay","stage":null},"status":"inactive","active_cards":0,"money_in":0.0,"money_out":-0.0,"balance":0.0,"begin_balance":0.0,"settled":0.0,"refund":0.0,"pending":0.0,"reversed_amount":0.0,"fx_fee":0.0,"cross_border_fee":0.0,"decline_fee":0.0,"spend":-0.0},{"id":30,"name":"1091129","type":3,"company":{"id":21,"name":"ComapnyCreated","owner_type":"client"},"provider":{"id":1,"name":"Core Pay","stage":null},"status":"inactive","active_cards":0,"money_in":0.0,"money_out":-0.0,"balance":0.0,"begin_balance":0.0,"settled":0.0,"refund":0.0,"pending":0.0,"reversed_amount":0.0,"fx_fee":0.0,"cross_border_fee":0.0,"decline_fee":0.0,"spend":-0.0},{"id":32,"name":"1012677","type":3,"company":{"id":23,"name":"Referral","owner_type":"client"},"provider":{"id":1,"name":"Core Pay","stage":null},"status":"inactive","active_cards":0,"money_in":0.0,"money_out":-0.0,"balance":0.0,"begin_balance":0.0,"settled":0.0,"refund":0.0,"pending":0.0,"reversed_amount":0.0,"fx_fee":0.0,"cross_border_fee":0.0,"decline_fee":0.0,"spend":-0.0},{"id":33,"name":"1069665","type":3,"company":{"id":24,"name":"SomeReferee","owner_type":"client"},"provider":{"id":1,"name":"Core Pay","stage":null},"status":"inactive","active_cards":0,"money_in":0.0,"money_out":-0.0,"balance":0.0,"begin_balance":0.0,"settled":0.0,"refund":0.0,"pending":0.0,"reversed_amount":0.0,"fx_fee":0.0,"cross_border_fee":0.0,"decline_fee":0.0,"spend":-0.0},{"id":2,"name":"1000002","type":1,"company":null,"provider":{"id":2,"name":"ConnexPay","stage":null},"status":"active","active_cards":0,"money_in":0.0,"money_out":-0.0,"balance":93103.0,"begin_balance":93103.0,"settled":0.0,"refund":0.0,"pending":0.0,"reversed_amount":0.0,"fx_fee":0.0,"cross_border_fee":0.0,"decline_fee":0.0,"spend":-0.0}]}}')


@allure.title('Admin account list ordering by end_balance')
def test_admin_account_list_ordering_by_end_balance(auth_token, api_request_context: APIRequestContext) -> None:
    headers = {
        'Authorization': f"Token {auth_token}"
    }
    response = api_request_context.get(
        '/api/admin/account?ordering=end_balance&date_start=2024-05-18&date_end=2024-05-19', headers=headers
    )

    assert response.status == 200
    assert response.text().__contains__('"next":"https://dev.api.devhost.io/api/admin/account?date_end=2024-05-19&date_start=2024-05-18&ordering=end_balance&page=2","previous":null,"results":{"total_sum":{"money_in":0.0,"money_out":-0.0'),('"settled":980.0,"refund":160.0,"pending":810.0,"reversed_amount":183.0,"fx_fee":7.17,"cross_border_fee":14.47,"decline_fee":4.5,"spend":-1656.14},"data":[{"id":18,"name":"2000018","type":2,"company":null,"provider":{"id":2,"name":"ConnexPay","stage":null},"status":"active","active_cards":0,"money_in":0.0,"money_out":-0.0,"balance":-500208.0,"begin_balance":-500208.0,"settled":0.0,"refund":0.0,"pending":0.0,"reversed_amount":0.0,"fx_fee":0.0,"cross_border_fee":0.0,"decline_fee":0.0,"spend":-0.0},{"id":46,"name":"1022159","type":3,"company":{"id":37,"name":"SeventhReferee","owner_type":"client"},"provider":{"id":1,"name":"Core Pay","stage":null},"status":"inactive","active_cards":0,"money_in":0.0,"money_out":-0.0,"balance":0.0,"begin_balance":0.0,"settled":0.0,"refund":0.0,"pending":0.0,"reversed_amount":0.0,"fx_fee":0.0,"cross_border_fee":0.0,"decline_fee":0.0,"spend":-0.0},{"id":41,"name":"1052836","type":3,"company":{"id":32,"name":"ThirdReferee","owner_type":"client"},"provider":{"id":1,"name":"Core Pay","stage":null},"status":"active","active_cards":0,"money_in":0.0,"money_out":-0.0,"balance":0.0,"begin_balance":0.0,"settled":0.0,"refund":0.0,"pending":0.0,"reversed_amount":0.0,"fx_fee":0.0,"cross_border_fee":0.0,"decline_fee":0.0,"spend":-0.0},{"id":44,"name":"1031276","type":3,"company":{"id":35,"name":"SixthReferee","owner_type":"client"},"provider":{"id":1,"name":"Core Pay","stage":null},"status":"active","active_cards":0,"money_in":0.0,"money_out":-0.0,"balance":0.0,"begin_balance":0.0,"settled":0.0,"refund":0.0,"pending":0.0,"reversed_amount":0.0,"fx_fee":0.0,"cross_border_fee":0.0,"decline_fee":0.0,"spend":-0.0},{"id":45,"name":"1063367","type":3,"company":{"id":36,"name":"SecondReferrer","owner_type":"client"},"provider":{"id":1,"name":"Core Pay","stage":null},"status":"active","active_cards":0,"money_in":0.0,"money_out":-0.0,"balance":0.0,"begin_balance":0.0,"settled":0.0,"refund":0.0,"pending":0.0,"reversed_amount":0.0,"fx_fee":0.0,"cross_border_fee":0.0,"decline_fee":0.0,"spend":-0.0},{"id":39,"name":"1027460","type":3,"company":{"id":30,"name":"FirstReferee","owner_type":"client"},"provider":{"id":1,"name":"Core Pay","stage":null},"status":"inactive","active_cards":0,"money_in":0.0,"money_out":-0.0,"balance":0.0,"begin_balance":0.0,"settled":0.0,"refund":0.0,"pending":0.0,"reversed_amount":0.0,"fx_fee":0.0,"cross_border_fee":0.0,"decline_fee":0.0,"spend":-0.0},{"id":42,"name":"1034592","type":3,"company":{"id":33,"name":"FourthReferee","owner_type":"client"},"provider":{"id":1,"name":"Core Pay","stage":null},"status":"active","active_cards":0,"money_in":0.0,"money_out":-0.0,"balance":0.0,"begin_balance":0.0,"settled":0.0,"refund":0.0,"pending":0.0,"reversed_amount":0.0,"fx_fee":0.0,"cross_border_fee":0.0,"decline_fee":0.0,"spend":-0.0},{"id":38,"name":"1047746","type":3,"company":{"id":29,"name":"FirstReferrer","owner_type":"client"},"provider":{"id":1,"name":"Core Pay","stage":null},"status":"active","active_cards":0,"money_in":0.0,"money_out":-0.0,"balance":0.0,"begin_balance":0.0,"settled":0.0,"refund":0.0,"pending":0.0,"reversed_amount":0.0,"fx_fee":0.0,"cross_border_fee":0.0,"decline_fee":0.0,"spend":-0.0},{"id":34,"name":"1012521","type":3,"company":{"id":25,"name":"SomeReferee2","owner_type":"client"},"provider":{"id":1,"name":"Core Pay","stage":null},"status":"inactive","active_cards":0,"money_in":0.0,"money_out":-0.0,"balance":0.0,"begin_balance":0.0,"settled":0.0,"refund":0.0,"pending":0.0,"reversed_amount":0.0,"fx_fee":0.0,"cross_border_fee":0.0,"decline_fee":0.0,"spend":-0.0},{"id":43,"name":"1010976","type":3,"company":{"id":34,"name":"FifthReferee","owner_type":"client"},"provider":{"id":1,"name":"Core Pay","stage":null},"status":"active","active_cards":0,"money_in":0.0,"money_out":-0.0,"balance":0.0,"begin_balance":0.0,"settled":0.0,"refund":0.0,"pending":0.0,"reversed_amount":0.0,"fx_fee":0.0,"cross_border_fee":0.0,"decline_fee":0.0,"spend":-0.0},{"id":17,"name":"2000017","type":5,"company":null,"provider":{"id":2,"name":"ConnexPay","stage":null},"status":"active","active_cards":0,"money_in":0.0,"money_out":-0.0,"balance":0.0,"begin_balance":0.0,"settled":0.0,"refund":0.0,"pending":0.0,"reversed_amount":0.0,"fx_fee":0.0,"cross_border_fee":0.0,"decline_fee":0.0,"spend":-0.0},{"id":51,"name":"1040434","type":3,"company":{"id":42,"name":"New2Referee","owner_type":"client"},"provider":{"id":1,"name":"Core Pay","stage":null},"status":"inactive","active_cards":0,"money_in":0.0,"money_out":-0.0,"balance":0.0,"begin_balance":0.0,"settled":0.0,"refund":0.0,"pending":0.0,"reversed_amount":0.0,"fx_fee":0.0,"cross_border_fee":0.0,"decline_fee":0.0,"spend":-0.0},{"id":35,"name":"1091606","type":3,"company":{"id":26,"name":"Some Referee 3","owner_type":"client"},"provider":{"id":1,"name":"Core Pay","stage":null},"status":"active","active_cards":0,"money_in":0.0,"money_out":-0.0,"balance":0.0,"begin_balance":0.0,"settled":0.0,"refund":0.0,"pending":0.0,"reversed_amount":0.0,"fx_fee":0.0,"cross_border_fee":0.0,"decline_fee":0.0,"spend":-0.0},{"id":20,"name":"1015919","type":3,"company":{"id":11,"name":"123","owner_type":"client"},"provider":{"id":1,"name":"Core Pay","stage":null},"status":"inactive","active_cards":0,"money_in":0.0,"money_out":-0.0,"balance":0.0,"begin_balance":0.0,"settled":0.0,"refund":0.0,"pending":0.0,"reversed_amount":0.0,"fx_fee":0.0,"cross_border_fee":0.0,"decline_fee":0.0,"spend":-0.0},{"id":21,"name":"1019702","type":3,"company":{"id":12,"name":"456","owner_type":"client"},"provider":{"id":1,"name":"Core Pay","stage":null},"status":"inactive","active_cards":0,"money_in":0.0,"money_out":-0.0,"balance":0.0,"begin_balance":0.0,"settled":0.0,"refund":0.0,"pending":0.0,"reversed_amount":0.0,"fx_fee":0.0,"cross_border_fee":0.0,"decline_fee":0.0,"spend":-0.0},{"id":22,"name":"1097981","type":3,"company":{"id":13,"name":"The Great","owner_type":"client"},"provider":{"id":1,"name":"Core Pay","stage":null},"status":"inactive","active_cards":0,"money_in":0.0,"money_out":-0.0,"balance":0.0,"begin_balance":0.0,"settled":0.0,"refund":0.0,"pending":0.0,"reversed_amount":0.0,"fx_fee":0.0,"cross_border_fee":0.0,"decline_fee":0.0,"spend":-0.0},{"id":23,"name":"1096379","type":3,"company":{"id":14,"name":"GreatTraffic","owner_type":"client"},"provider":{"id":1,"name":"Core Pay","stage":null},"status":"inactive","active_cards":0,"money_in":0.0,"money_out":-0.0,"balance":0.0,"begin_balance":0.0,"settled":0.0,"refund":0.0,"pending":0.0,"reversed_amount":0.0,"fx_fee":0.0,"cross_border_fee":0.0,"decline_fee":0.0,"spend":-0.0},{"id":24,"name":"1071877","type":3,"company":{"id":15,"name":"The Tesla","owner_type":"client"},"provider":{"id":2,"name":"ConnexPay","stage":null},"status":"inactive","active_cards":0,"money_in":0.0,"money_out":-0.0,"balance":0.0,"begin_balance":0.0,"settled":0.0,"refund":0.0,"pending":0.0,"reversed_amount":0.0,"fx_fee":0.0,"cross_border_fee":0.0,"decline_fee":0.0,"spend":-0.0},{"id":25,"name":"1087426","type":3,"company":{"id":16,"name":"1234","owner_type":"client"},"provider":{"id":1,"name":"Core Pay","stage":null},"status":"inactive","active_cards":0,"money_in":0.0,"money_out":-0.0,"balance":0.0,"begin_balance":0.0,"settled":0.0,"refund":0.0,"pending":0.0,"reversed_amount":0.0,"fx_fee":0.0,"cross_border_fee":0.0,"decline_fee":0.0,"spend":-0.0},{"id":26,"name":"1094765","type":3,"company":{"id":17,"name":"1231","owner_type":"client"},"provider":{"id":1,"name":"Core Pay","stage":null},"status":"inactive","active_cards":0,"money_in":0.0,"money_out":-0.0,"balance":0.0,"begin_balance":0.0,"settled":0.0,"refund":0.0,"pending":0.0,"reversed_amount":0.0,"fx_fee":0.0,"cross_border_fee":0.0,"decline_fee":0.0,"spend":-0.0},{"id":27,"name":"1054195","type":3,"company":{"id":18,"name":"1232","owner_type":"client"},"provider":{"id":1,"name":"Core Pay","stage":null},"status":"inactive","active_cards":0,"money_in":0.0,"money_out":-0.0,"balance":0.0,"begin_balance":0.0,"settled":0.0,"refund":0.0,"pending":0.0,"reversed_amount":0.0,"fx_fee":0.0,"cross_border_fee":0.0,"decline_fee":0.0,"spend":-0.0},{"id":30,"name":"1091129","type":3,"company":{"id":21,"name":"ComapnyCreated","owner_type":"client"},"provider":{"id":1,"name":"Core Pay","stage":null},"status":"inactive","active_cards":0,"money_in":0.0,"money_out":-0.0,"balance":0.0,"begin_balance":0.0,"settled":0.0,"refund":0.0,"pending":0.0,"reversed_amount":0.0,"fx_fee":0.0,"cross_border_fee":0.0,"decline_fee":0.0,"spend":-0.0},{"id":32,"name":"1012677","type":3,"company":{"id":23,"name":"Referral","owner_type":"client"},"provider":{"id":1,"name":"Core Pay","stage":null},"status":"inactive","active_cards":0,"money_in":0.0,"money_out":-0.0,"balance":0.0,"begin_balance":0.0,"settled":0.0,"refund":0.0,"pending":0.0,"reversed_amount":0.0,"fx_fee":0.0,"cross_border_fee":0.0,"decline_fee":0.0,"spend":-0.0},{"id":33,"name":"1069665","type":3,"company":{"id":24,"name":"SomeReferee","owner_type":"client"},"provider":{"id":1,"name":"Core Pay","stage":null},"status":"inactive","active_cards":0,"money_in":0.0,"money_out":-0.0,"balance":0.0,"begin_balance":0.0,"settled":0.0,"refund":0.0,"pending":0.0,"reversed_amount":0.0,"fx_fee":0.0,"cross_border_fee":0.0,"decline_fee":0.0,"spend":-0.0},{"id":52,"name":"1077344","type":3,"company":{"id":43,"name":"TestAirtable","owner_type":"client"},"provider":{"id":1,"name":"Core Pay","stage":null},"status":"inactive","active_cards":0,"money_in":0.0,"money_out":-0.0,"balance":0.0,"begin_balance":0.0,"settled":0.0,"refund":0.0,"pending":0.0,"reversed_amount":0.0,"fx_fee":0.0,"cross_border_fee":0.0,"decline_fee":0.0,"spend":-0.0}]}}')


@allure.title('Admin account list ordering by spend, filter by company_owner_type & status & provider')
def test_admin_account_list_ordering_by_spend_and_some_filters(auth_token,
                                                               api_request_context: APIRequestContext) -> None:
    headers = {
        'Authorization': f"Token {auth_token}"
    }
    response = api_request_context.get(
        '/api/admin/account?status=active&company_owner_type=client&provider=2&ordering=spend&date_start=2024-05-18&date_end=2024-05-19',
        headers=headers
    )

    assert response.status == 200
    assert response.text().__contains__('"next":"https://dev.api.devhost.io/api/admin/account?company_owner_type=client&date_end=2024-05-19&date_start=2024-05-18&ordering=spend&page=2&provider=2&status=active","previous":null,"results":{"total_sum":{"money_in":0.0,"money_out":-0.0,"balance"'), ('"begin_balance":')
    assert response.text().__contains__('"money_in":0.0,"money_out":-0.0,"balance":163597.84999999998,"begin_balance":163597.84999999998,"settled":0.0,"refund":0.0,"pending":0.0,"reversed_amount":0.0,"fx_fee":0.0,"cross_border_fee":0.0,"decline_fee":0.0,"spend":-0.0}')
    assert response.text().__contains__('{"id":177,"name":"1026728","type":3,"company":{"id":168,"name":"red company","owner_type":"client"},"provider":{"id":2,"name":"ConnexPay","stage":null},"status":"active","active_cards":2,"money_in":0.0,"money_out":-0.0,"balance":1904.7399999999998,"begin_balance":2434.7,"settled":355.0,"refund":48.0,"pending":214.0,"reversed_amount":61.0,"fx_fee":2.94,"cross_border_fee":4.52,"decline_fee":1.5,"spend":-529.96}')
    assert response.text().__contains__('{"id":181,"name":"1062075","type":3,"company":{"id":172,"name":"golden company","owner_type":"client"},"provider":{"id":2,"name":"ConnexPay","stage":null},"status":"active","active_cards":2,"money_in":0.0,"money_out":-0.0,"balance":2026.9,"begin_balance":2250.94,"settled":22.0,"refund":16.0,"pending":214.0,"reversed_amount":0.0,"fx_fee":0.93,"cross_border_fee":3.11,"decline_fee":0.0,"spend":-224.04000000000002}')
    assert response.text().__contains__('{"id":176,"name":"1047836","type":3,"company":{"id":167,"name":"white company","owner_type":"client"},"provider":{"id":2,"name":"ConnexPay","stage":null},"status":"active","active_cards":4,"money_in":0.0,"money_out":-0.0,"balance":615.9599999999999,"begin_balance":810.3199999999999,"settled":155.0,"refund":48.0,"pending":84.0,"reversed_amount":61.0,"fx_fee":0.14,"cross_border_fee":1.72,"decline_fee":1.5,"spend":-194.35999999999999}')


@allure.title('Admin account list no auth')
def test_admin_account_list_no_auth(api_request_context: APIRequestContext) -> None:
    response = api_request_context.get(
        '/api/admin/account')

    assert response.status == 401
    assert response.text() == AUTH_NOT_PROVIDED


@allure.title('Admin account list not admin')
def test_admin_account_list_not_admin(auth_login_user_data_ru, api_request_context: APIRequestContext) -> None:
    headers = {
        'Authorization': f"Token {auth_login_user_data_ru}"
    }
    response = api_request_context.get(
        '/api/admin/account?date_start=2024-05-18&date_end=2024-05-18', headers=headers
    )

    assert response.status == 403
    assert response.text() == PERMISSIONS


@allure.title('Admin account balance list')
def test_admin_account_balance_list(auth_token, api_request_context: APIRequestContext) -> None:
    headers = {
        'Authorization': f"Token {auth_token}"
    }
    response = api_request_context.get(
        '/api/admin/account/balance?provider_id=2', headers=headers
    )

    assert response.status == 200
    assert response.text().__contains__("credit")
    assert response.text().__contains__("client")
    assert response.text().__contains__("balance")
    assert response.text().__contains__("authorization")
    assert response.text().__contains__("master")
